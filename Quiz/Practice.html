<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIFA Aircraft Rec</title>
    <link rel="stylesheet" href="../cleancss.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../CSS/practice.css">
</head>
<body>
    <main>
        <img src="" alt="A photo of a mid air refuelling tanker flying overhead at a low altitude">
        <div class="central">
            <div id="qindicator"><p>Question 1<!-- #Question number here --></p></div>
           <hr>
           <div id="score"><p>Score: 0<!-- #Score derived from calculation here --></p></div>
        </div>
        <div class="questions">
            <!-- #Replace with DB-inserted aircraft -->
            <h2>What is the manufacturer?</h2>
           <ul>
               <li><p></p></li>
               <li><p></p></li>
               <li><p></p></li>
               <li><p></p></li>
            </ul>
            <h2>What is the model?</h2>
            <ul>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
            </ul>
            <h2>What is the common name?</h2>
            <ul>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
            </ul>
            <div class="buttons">
                <button id="submit"><p>Submit</p></button>
                <p id="skip">Next Question</p></div>
            </div>
        </div>
    </main>
    <script src="../script.js"></script>
    <script>
        // Function to shuffle an array (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
        }
        
        // Event listener for the "Skip" button
        document.getElementById('skip').addEventListener('click', fetchAndDisplayQuestion);
        
        // Initial call to load the first question
        fetchAndDisplayQuestion();

        let correctAnswers = {}; // Object to store the correct answers

        function fetchAndDisplayQuestion() {
            fetch('http://127.0.0.1:1337/random-question')
                .then(response => response.json())
                .then(questionData => {
                    // Update the aircraft image
                    const aircraftImage = document.querySelector('main img');
                    aircraftImage.src = `../img/Aircraft/${questionData.correctAircraft.imgSrc}.png`;
                    aircraftImage.alt = `A photo of ${questionData.correctAircraft.model}`;
        
                    // Shuffle and display manufacturer answers
                    let manufacturerAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                    document.querySelectorAll('.questions ul')[0].innerHTML = manufacturerAnswers.map(answer => `<li><p>${answer.manufacturer}</p></li>`).join('');
        
                    // Shuffle and display model answers
                    let modelAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                    document.querySelectorAll('.questions ul')[1].innerHTML = modelAnswers.map(answer => `<li><p>${answer.model}</p></li>`).join('');
        
                    // Shuffle and display common name answers
                    let commonNameAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                    document.querySelectorAll('.questions ul')[2].innerHTML = commonNameAnswers.map(answer => `<li><p>${answer.altname}</p></li>`).join('');

                    // Store correct answers for comparison
                    correctAnswers = {
                        manufacturer: questionData.correctAircraft. manufacturer,
                        model: questionData.correctAircraft.model,
                        altname: questionData.correctAircraft.altname,
                    };

                    // Add click event listeners to each answer
                    const questionLists = document.querySelectorAll('.  questions ul');
                    questionLists.forEach((list, index) => {
                        list.addEventListener('click', function(event) {
                            if (event.target.tagName === 'P') {
                                // Remove existing selections
                                list.querySelectorAll('li').forEach(li =>   li.classList.remove('selected'));
                                // Mark the clicked answer as selected
                                event.target.parentElement.classList.add    ('selected');
                            }
                        });
                    });
                })
                .catch(error => console.error('Error fetching question  data:', error));
        }

        // Function to check answers and apply classes
        function checkAnswers() {
            const selectedAnswers = document.querySelectorAll('.questions   ul .selected p');
            if (selectedAnswers.length === 3) { // Ensure an answer is  selected for each question
                selectedAnswers.forEach((answer, index) => {
                    let answerType;
                    switch (index) {
                        case 0: answerType = 'manufacturer'; break;
                        case 1: answerType = 'model'; break;
                        case 2: answerType = 'altname'; break;
                    }
                    if (answer.textContent === correctAnswers[answerType])  {
                        answer.parentElement.classList.add('right');
                    } else {
                        answer.parentElement.classList.add('wrong');
                        // Also highlight the correct answer
                        document.querySelectorAll(`.questions ul:nth-child  (${index + 1}) li p`).forEach(p => {
                            if (p.textContent === correctAnswers    [answerType]) {
                                p.parentElement.classList.add('right');
                            }
                        });
                    }
                });
            } else {
                console.error('Please select an answer for each question.   ');
            }
        }

        // Add event listener to the Submit button
        document.getElementById('submit').addEventListener('click',     checkAnswers);

        // Add event listener to the Skip button
        document.getElementById('skip').addEventListener('click', function  () {
            fetchAndDisplayQuestion();
            // Reset the classes for new questions
            document.querySelectorAll('.questions ul li').forEach(li => {
                li.classList.remove('selected', 'right', 'wrong');
            });
        });

        // Initial call to load the first question
        fetchAndDisplayQuestion();
    </script>
</body>
</html>