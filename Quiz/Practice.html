<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIFA Aircraft Rec</title>
    <link rel="stylesheet" href="../cleancss.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../CSS/practice.css">
</head>
<body>
    <main>
        <img src="" alt="A photo of a mid air refuelling tanker flying overhead at a low altitude">
        <div class="central">
            <div id="qindicator"><p>Question 1<!-- #Question number here --></p></div>
           <hr>
           <div id="score"><p>Score: 0<!-- #Score derived from calculation here --></p></div>
        </div>
        <div class="questions">
            <!-- #Replace with DB-inserted aircraft -->
            <h2>What is the manufacturer?</h2>
           <ul>
               <li><p></p></li>
               <li><p></p></li>
               <li><p></p></li>
               <li><p></p></li>
            </ul>
            <h2>What is the model?</h2>
            <ul>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
            </ul>
            <h2>What is the common name?</h2>
            <ul>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
                <li><p></p></li>
            </ul>
            <div class="buttons">
                <button id="submit"><p>Submit</p></button>
                <p id="skip">Next Question</p></div>
            </div>
        </div>
        <a href="/menu" class="leave">
            <p>Go back</p>
        </a>
    </main>
    <script src="../script.js"></script>
    <script>
                // Assuming there's already a mechanism to determine if an answer is correct
    // Initialize score and question number
    let score = 0;
    let questionNumber = 1;

    // Function to update score and question number display
    function updateScoreAndQuestionDisplay() {
        const scoreDisplay = document.getElementById('score').querySelector('p');
        const questionDisplay = document.getElementById('qindicator').querySelector('p');
        scoreDisplay.textContent = `Score: ${score}`;
        questionDisplay.textContent = `Question ${questionNumber}`;
    }

    // Call this function whenever a question is correctly answered
    function correctAnswer() {
        score++;
        updateScoreAndQuestionDisplay();
    }

    // Call this function whenever a new question is fetched
    function newQuestionFetched() {
        questionNumber++;
        updateScoreAndQuestionDisplay();
    }

    // Initial display update
    updateScoreAndQuestionDisplay();

    // Example usage (you'll need to integrate these calls with your existing code)
    // correctAnswer(); // Call this when a correct answer is selected
    // newQuestionFetched(); // Call this when fetching a new question

    // Update the event listener for the "Skip" button to increment question number
    document.getElementById('skip').addEventListener('click', function() {
        newQuestionFetched();
        fetchAndDisplayQuestion(); // Assuming this function fetches and displays a new question
    });
        // Function to handle answer selection
    function handleAnswerSelection(event) {
        if (event.target.tagName === 'P') { // Ensure we're clicking on the <p> element
            const answers = event.target.closest('ul').querySelectorAll('p');
            answers.forEach(answer => answer.classList.remove('selected')); // Remove 'selected' from all answers
            event.target.classList.add('selected'); // Add 'selected' to clicked answer
        }
    }

function handleSubmit() {
    const selectedAnswers = document.querySelectorAll('.questions ul li p.selected'); // Only consider selected answers
    let correctSelectedCount = 0; // Count of correctly selected answers
    const totalCorrectAnswers = document.querySelectorAll('.questions ul li p[data-is-correct="true"]').length; // Total correct answers

    selectedAnswers.forEach(answer => {
        answer.classList.remove('selected'); // Remove 'selected' class
        if (answer.getAttribute('data-is-correct') === 'true') {
            answer.classList.add('correct'); // Correct answer
            correctSelectedCount++; // Increment count for correct selected answer
        } else {
            answer.classList.add('wrong'); // Incorrect answer
        }
    });

    // Check if all selected answers are correct and match the total number of correct answers
    if (correctSelectedCount === selectedAnswers.length && correctSelectedCount === totalCorrectAnswers) {
        correctAnswer(); // Increment score only if all selected answers are correct
    }

    // Optionally, highlight the correct answer if not selected
    document.querySelectorAll('.questions ul li p').forEach(answer => {
        if (answer.getAttribute('data-is-correct') === 'true') {
            answer.classList.add('correct'); // Ensure the correct answer is always highlighted
        }
    });

    newQuestionFetched(); // Increment question number for the next question
}

    // Add event listener to the submit button
    document.getElementById('submit').addEventListener('click', handleSubmit);

    // Function to reset classes for the next question
    function resetAnswerClasses() {
        const answers = document.querySelectorAll('.questions ul li p');
        answers.forEach(answer => {
            answer.classList.remove('selected', 'correct', 'wrong'); // Remove all related classes
        });
    }

    // Add event listeners to answers for selection
    document.querySelectorAll('.questions ul').forEach(ul => {
        ul.addEventListener('click', handleAnswerSelection);
    });

    // Add event listener to the submit button
    document.getElementById('submit').addEventListener('click', handleSubmit);

    // Modify the existing skip button event listener to also reset classes
    document.getElementById('skip').removeEventListener('click', fetchAndDisplayQuestion); // Remove the existing event listener
    document.getElementById('skip').addEventListener('click', () => {
        resetAnswerClasses();
        fetchAndDisplayQuestion(); // Call the original function to fetch and display the next question
    });
        // Function to shuffle an array (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
        }
        
        // Function to fetch and display a new aircraft question
    function fetchAndDisplayQuestion() {
        fetch('http://127.0.0.1:1337/random-question') // Adjust the fetch URL as necessary
            .then(response => response.json())
            .then(questionData => {
                // Update the aircraft image
                const aircraftImage = document.querySelector('main img');
                aircraftImage.src = `../img/Aircraft/${questionData.correctAircraft.id-1}.png`;
                aircraftImage.alt = `A photo of ${questionData.correctAircraft.model}`;

                // Shuffle and display manufacturer answers
                let manufacturerAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                document.querySelectorAll('.questions ul')[0].innerHTML = manufacturerAnswers.map(answer =>
                    `<li><p data-is-correct="${answer.manufacturer === questionData.correctAircraft.manufacturer}">${answer.manufacturer}</p></li>`
                ).join('');

                // Shuffle and display model answers
                let modelAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                document.querySelectorAll('.questions ul')[1].innerHTML = modelAnswers.map(answer =>
                    `<li><p data-is-correct="${answer.model === questionData.correctAircraft.model}">${answer.model}</p></li>`
                ).join('');

                // Shuffle and display common name answers
                let commonNameAnswers = shuffleArray([...questionData.wrongAnswers, questionData.correctAircraft]);
                document.querySelectorAll('.questions ul')[2].innerHTML = commonNameAnswers.map(answer =>
                    `<li><p data-is-correct="${answer.altname === questionData.correctAircraft.altname}">${answer.altname}</p></li>`
                ).join('');
            })
            .catch(error => console.error('Error fetching question data:', error));
    }
        
        // Event listener for the "Skip" button
        document.getElementById('skip').addEventListener('click', fetchAndDisplayQuestion);
        
        // Initial call to load the first question
        fetchAndDisplayQuestion();
    </script>
</body>
</html>